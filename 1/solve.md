# Домашка

1. Нажать “Do one!” на этом сайте: [architecturalkatas.com](https://www.architecturalkatas.com/)
2. Ознакомиться с вводными
3. Целиком пройти этап **«Сбор и анализ требований»**:
    - Отсев
    - Scope Refinement
    - Функциональные требования
    - Нефункциональные требования
    - Ограничения
    - Расчет нагрузки:
        * Трафик
        * БД
4. Сформировать отчет по правилам ниже

*Доп. вводные:*  
Вы находитесь в России, 2025 год.

---

## Формат сдачи
1. Форкнуть репу к себе
2. Сделать собственную ветку
3. ДЗ оформить в `.md` файл и запушить
4. Сделать мердж-реквест в `master` и поставить меня в **Reviewer** (@nikolaysavelev)

**Дедлайн:** 2 недели (26.04)

# Полученное условие

Your Architectural Kata is...
Going Green
A large electronics store wants to get into the electronics recycling business and needs a new system to support it. Customers can send in their small personal electronic equipment (or use local kiosks at the mall) and possibly get money for their used equipment if it is in working condition.

Users: Hundreds, hopefully thousands to millions

Requirements:

Customers can get a quote for used personal electronic equipment (phones, cameras, etc.) either through the web or a kiosk at a mall.

Customers will receive a box in the mail, send in their electronic, and if it is in good working order receive a check.

Once the equipment is received, it is assessed (inspected) to determine if it can be either recycled (destroyed safely) or sold (yandex-market, etc.).

The company anticipates adding 5-10 new types of electronic that they will accept each month.

Each type of electronic has its own set of rules for quoting and assessment.

Additional Context:

This is a highly competitive business and is a new line of business for us

If we haven’t received a type of electronic equipment in a year we will remove it from our system

We need to maintain a list of electronic equipment we are willing to accept as it changes often

Each piece of equipment has it’s own assessment (inspection) rules

We have the right to change the original quote to the customer if the product isn’t in the condition they said it was

# Решение

## Отсев

Что будет, если не реализовать систему?
- Потеря конкурентного преимущества в нише переработки электроники
- Упущенная выгода от перепродажи рабочего оборудования (yandex-market и аналоги)
- Репутационные риски — компания позиционирует себя как экологически ответственная

Как будем мерить успех? (метрики)
- Количество сданного оборудования в месяц (KPI: рост на 20% ежеквартально)
- % оборудования, отправленного на перепродажу (цель: ≥30%)
- Удовлетворенность клиентов (NPS ≥70)
- Сокращение затрат на утилизацию (на 15% в год)

Какие Discovery-материалы, ресурсы?
- Discovery-материалы минимальные, пока нет глубокой аналитики стартовой принимаемой техники, а также данных о конкурентах (а так как область высококонкурентная, то эти данные нужно динамически и регулярно обновлять)
- Бюджет должен учитывать затраты на разработку ПО (команду), логистику (коробки, доставка), содержание киосков в ТЦ
- Инфраструктура: облако + CRM для учета заявок, API интеграции с платежными системами

Реалистичность
- Идея реалистичная за счет уже высокой конкуренции на рынке - это означает, что уже есть спрос на такие услуги и реализованные предложения
- Есть риск: клиент может отказаться от сервиса, если предложение после оценки будет низкое
- Есть риск: санкции могут привести к тому, что потребуется импортозамещение инфраструктуры и новые интеграции с другими российскими аналогами платежных систем, API, интернет-магазинами
- Для реалистичной реализации сначала стоит подготовить MVP на ближайшие N месяцев: например, без киосков, с онлайн-оценкой + отправкой коробок. Далее уже улучшать и машстабировать идею

## Scope Refinement

Пользователи:
- Клиенты (физические лица)
- Операторы оценки оборудования
- Администраторы (управление списком оборудования, правилами)

Основные функции:
- Получение предварительного предложения через веб-сайт или киоск
- Отправка оборудования по почте
- Оценка состояния оборудования
- Уведомление клиентов о статусе оценки
- Выплата вознаграждения или утилизация
- Управление списком принимаемого оборудования (добавление/удаление)

Дополнительные функции:
- Интеграция с yandex-market для перепродажи
- Генерация чеков/ваучеров

## Функциональные требования

### Акторы (Actors)
- Клиент – подает заявку на оценку, отправляет технику, получает вознаграждение
- Оператор оценки – проверяет состояние оборудования, вносит данные в систему
- Администратор – управляет списком принимаемой техники, правилами оценки
- Система платежей – автоматизирует выплаты
- Партнер (yandex-market и аналоги) – получает данные о технике для перепродажи

### Домен и бизнес-процессы

Данные:
- Учет оборудования (тип, состояние, стоимость)
- Заявки клиентов (ID, статус, предложенная цена, результирующая цена)
- Платежи (реквизиты, история транзакций)

Бизнес-процессы:
1. Клиент создает заявку → система генерирует предложение → отправка коробки
2. Получение техники → оценка оператором → подтверждение/корректировка цены
3. Выплата вознаграждения или утилизация
4. Администрирование: добавление новых типов техники, обновление правил оценки

### Основные функции системы (MVP):

1. Подача заявки:
	- Через веб-сайт/мобильное приложение (фото техники, описание)
	- Через киоск (сканер QR-кода, ввод данных)

2. Оценка стоимости:
	- Автоматическая предварительная оценка (на основе модели)
	- Ручная проверка оператором (финальное решение)

3. Логистика:
	- Генерация почтового ярлыка для отправки
	- Трекинг статуса (получено, в процессе оценки, завершено)

4. Платежи:
	- Выплата на карту/электронный кошелек
	- Уведомление клиента

5. Админ-панель:
	- CRUD для типов техники и правил оценки
	- Аналитика (сколько техники принято, % перепродажи)

Дополнительно (хотелки):
- Интеграция с yandex-market (автоматическая публикация лотов)
- Геймификация (баллы за сдачу техники, которые можно обменять на скидки)
- Чат с поддержкой для спорных случаев

### Use Cases

UC-1: Клиент сдает iPhone
1. Клиент заходит на сайт, выбирает «Смартфон» → «iPhone 12»
2. Система запрашивает фото и описание (есть ли царапины, работает ли экран)
3. Автоматическая оценка: 15 000 ₽ (если состояние «хорошее»)
4. Клиент соглашается → получает QR-код для бесплатной отправки
5. После проверки оператором цена корректируется до 12 000 ₽ (царапины на корпусе)
6. Клиент подтверждает новую цену → выплата на карту

UC-2: Администратор добавляет новый тип техники
1. В админ-панели выбирает «Добавить тип» → «Электронные книги»
2. Загружает правила оценки:
	- Проверка экрана (нет битых пикселей)
	- Батарея держит заряд ≥80%
3. Система обновляет список на сайте мгновенно

### Корнер-кейсы:
- Клиент отправил не тот товар → уведомление + возврат за его счет
- Оборудование сломалось при транспортировке → страховой случай (партнерская логистика)
- yandex-market отклонил лот из-за политики → ручная модерация администратором

### User Stories (JTBD)
- Как клиент, я хочу быстро получить предварительную оценку техники, чтобы понять, стоит ли ее сдавать
- Как оператор, я хочу видеть все данные о технике в одном интерфейсе, чтобы сократить время проверки
- Как администратор, я хочу гибко настраивать правила оценки, чтобы учитывать новые модели техники

## Нефункциональные требования

1. Производительность 
- Время отклика:
	- Предварительная оценка: ≤2 сек
	- Загрузка ЛК клиента: ≤1 сек
	- Заявки должны обрабатываться в очереди с задержкой ≤5 мин

2. Масштабируемость
- Автоматическое добавление серверов при нагрузке >80% CPU
- Разделение на микросервисы: оценка техники, платежи, логистика, личный кабинет

3. Отказоустойчивость
- SLA: 99.9% uptime
- Использование 2+ ЦОД (напирме, Москва, Екатеринбург)
- Правильно настроенная база данных с репликациями и шардированием (например, по типу техниики)
- При падении платежного сервиса - нужно иметь возможность быстрого уведомления пользователей

4. Безопасность
- OAuth 2.0 + 2FA для админов
- Защита от DDOS атак (хотя бы базовая с rate-limiting)

5. Мониторинг
- Настроенные метрики + логи + алерты: prometheus, grafana, elk, tg-bot

6. Регуляторные требования
- Соответствие ФЗ-152 (хранение перс. данных)
- Лицензия на утилизацию электроники
- Отчетность в Налоговую (чеки через ОФД)

7. Переносимость и совместимость
- Импортозамещение: использование российских БД, очередей и облачных пространств

8. Пользователський опыт
- Поддержка мобильных телефонов (мобильная версия веб-платформы или приложение)
- Поддержка английского языка

Влияние на ФТ
- Безопасность → ФТ:
	- Добавить подтверждение телефона для выплат.
- Регуляторные → ФТ:
	- Хранение сканов паспортов для выплат >15 000 ₽ (ФЗ-115).

## Ограничения

1. Бизнес-модель
- B2C (клиенты — физлица), с потенциалом B2B (партнерство с корпорациями для массовой сдачи техники)

2. Бизнес-метрики
- DAU/MAU: 10 000 / 100 000 (цель на первый год)
- Retention: 30% клиентов вернутся через 6 месяцев (лояльность через бонусы)
- ROI: Окупаемость за 2 года (за счет перепродажи 30% техники)

3. География
- Старт: Москва и СПб (киоски в ТЦ)
- Расширение: Вся Россия (логистика СДЭК/Почта России)
- Мировой рынок: Не раньше 2027 года (санкционные риски)

4. Специфика домена
- eCommerce (онлайн-оценка и продажа) + GreenTech (экологичность)

5. Тип устройств
- Браузер (80% трафика) → Chrome, Safari (1-ый этап)
- Киоски → Тачскрин + сканер QR-кодов (2-ой этап)
- Мобильные приложения (20%) → iOS/Android (N-ый этап)

6. Этап развития
- MVP (6 месяцев):
	- Веб-версия + ручная оценка
	- Интеграция с 1 платежной системой (Т-Банк)
- Full-Scale (2 года):
	- Киоски в ТЦ
	- Партнерство с yandex-market (и аналогами)

7. Тип развертывания
Cloud (Yandex Cloud): быстрое масштабирование, гибридная модель для хранения персональных данных (On-Premise для ФИО и паспортов)

8. Время разработки
- MVP: 6 месяцев (команда 5 разработчиков)
- Full-Scale: 1.5–2 года

9. Бюджет на технологии
- MVP: 8 млн ₽ (разработка + тестовая реклама)
- Годовое сопровождение: 3 млн ₽ (поддержка + мониторинг)

10. Технологии
- Backend: Python (FastAPI) / Go (для высоконагруженных сервисов)
- Frontend: React (PWA)
- БД: PostgreSQL → ClickHouse для аналитики
- Кэш: Redis
- Переиспользование: CRM «Битрикс24» для учета клиентов

11. Существующие сервисы
- Платежи: Т-Банк, Сбер
- Логистика: Почта России (договор на льготные тарифы), CDEK

12. Бюджет на железо
- Cloud: 200 000 ₽/мес (на старте)
- Киоски: 500 000 ₽/шт (пилот — 2 шт.)

13. SLA
- Техническая описана выше
- Выплаты — ≤24 часов

14. Регуляторные требования
- ФЗ-152: Хранение персональных данных в РФ
- ФЗ-115: Верификация клиентов при выплатах >15 000 ₽
- Экология: Лицензия Росприроднадзора на утилизацию

15. Интеграции
- Платежные системы (Сбербанк, ЮMoney)
- Маркетплейсы (yandex-market и аналоги)
- 1С для бухгалтерии

16. Санкции и импортозамещение
- Миграция с GitHub → GitLab (on-premise)
- Использование российских решений (ClickHouse, Tarantool)

## Расчет нагрузки

### Расчет трафика

Входные данные:
- Ожидаемое количество пользователей:
	- 50 000 уникальных посетителей/месяц (на старте)
	- 500 000 уникальных посетителей/месяц (через 1 год)
- Пиковая нагрузка:
	- Акции/реклама → в 5 раз выше средних значений

Метрики:
- RPS (Requests Per Second):
	- Средняя нагрузка: 50 000 пользователей → ~2 000 сессий/день → 25 RPS
	- Пиковая нагрузка: 500 RPS (кратковременно, например, при запуске рекламы)

- Объем данных:
	- Заявка на оценку: Фото (500 KB) + метаданные (10 KB) = 510 KB/запрос

- Сетевой трафик:
	- 25 RPS * 510 KB = 12.75 MB/сек (стандарт)
	- 500 RPS * 510 KB = 255 MB/сек (пик)

### Расчет нагрузки на БД

Входные данные:
- Количество заявок: 50 000 заявок/месяц → 1 667 заявок/день
- Хранение данных:
	- Горячие данные: 3 месяца
	- Холодные данные: 5 лет

Метрики:
- Объем данных:
	- Одна заявка: Фото (500 KB) + JSON-метаданные (10 KB) = 510 KB
	- В месяц: 50 000 * 510 KB = 25.5 GB
	- За 5 лет: 25.5 GB * 60 месяцев = 1.53 TB

Нагрузка на БД:
- Чтение: 100 RPS (просмотр статуса заявки)
- Запись: 50 RPS (новая заявка/обновление статуса)
- Использование индексо: может быть прирост +20% к исходным данным
